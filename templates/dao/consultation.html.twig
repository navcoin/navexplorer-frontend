{% extends "base.html.twig" %}

{% block title %}{{ consultation.question }}{% endblock %}
{% block description %}NavCoin DAO Consultations{% endblock %}

{% block page %}page-dao-consultation{% endblock %}


{% block body %}
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <h1>DAO</h1>
                <h2>Consultation</h2>
            </div>
        </div>


        <div class="row">
            <div class="col-md-12">
                {% if consultation.state == 3 %}
                    <div class="alert alert-danger">
                        This consultation has expired
                    </div>
                {% else %}
                    <div class="alert alert-info">
                        Votes counted for block <strong>{{ blockCycle.currentBlock|number_format }}</strong> of <strong>{{ blockCycle.blocksInCycle|number_format }}</strong> in the {{ consultation.votingCycle|ordinal }} voting cycle.<br/>
                        {% if blockCycle.remainingBlocks == 1 %}
                            There is <strong>{{ blockCycle.remainingBlocks|number_format }}</strong> block remaining.
                        {% else %}
                            There are <strong>{{ blockCycle.remainingBlocks|number_format }}</strong> blocks remaining.
                        {% endif %}
                    </div>
                {% endif %}
            </div>
        </div>

        {% if consultation.state == 9 and consultation.votingCycle < 3 %}
            <div class="row">
                <div class="col-md-12">
                    <div class="alert alert-success">

                        <p>Consultation has found support<br/>Waiting until the end of voting cycle 2 to begin final voting</p>
                    </div>
                </div>
            </div>
        {% endif %}

        <div class="row margin-bottom">
            <div class="col-sm-12 col-md-8">
                <table class="table table-striped">
                    <tbody>
                    <tr>
                        <td><strong>Question</strong></td>
                        <td class="text-right break-word">{{ consultation.question }}</td>
                    </tr>
                    <tr>
                        <td><strong>Hash</strong></td>
                        <td class="text-right break-word">{{ consultation.hash }}</td>
                    </tr>
                    <tr>
                        <td><strong>Block Hash</strong></td>
                        <td class="text-right break-word">{{ consultation.blockHash }}</td>
                    </tr>
                    <tr>
                        <td><strong>Proposed By</strong></td>
                        <td class="text-right break-word">{{ consultation.proposedBy }}</td>
                    </tr>
                    <tr>
                        <td><strong>Status</strong></td>
                        <td class="text-right break-word">{{ consultation.status|capitalize }}</td>
                    </tr>
                    <tr>
                        <td><strong>Voting Cycle</strong></td>
                        <td class="text-right break-word">{{ consultation.votingCycle }}</td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <div class="col-sm-12 col-md-4">
                <table class="table table-striped">
                    <tbody>
                    <tr class="d-flex">
                        <td class="col-7"><strong>Version</strong></td>
                        <td class="text-right break-word col-5">
                            {{ consultation.version }}
                        </td>
                    </tr>
                    <tr class="d-flex">
                        <td class="col-7"><strong>Supports a range of answers</strong></td>
                        <td class="text-right break-word col-5">
                            {{ consultation.isARange ? 'true' : 'false' }}
                        </td>
                    </tr>
                    <tr class="d-flex">
                        <td class="col-7"><strong>Supports additional answers</strong></td>
                        <td class="text-right break-word col-5">
                            {{ consultation.allowsMoreAnswers ? 'true' : 'false' }}
                        </td>
                    </tr>
                    <tr class="d-flex">
                        <td class="col-7"><strong>Changes consensus</strong></td>
                        <td class="text-right break-word col-5">
                            {{ consultation.consensusParameter ? 'true' : 'false' }}
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>


        <h3>Answers</h3>

        <div class="row">
            {% for a in consultation.answers %}
                <div class="col-sm-12 col-md-6">
                    <table class="table table-striped margin-bottom">
                        <tbody>
                        <tr>
                            <td><strong>Hash</strong></td>
                            <td class="text-right break-word">{{ a.hash }}</td>
                        </tr>
                        <tr>
                            <td><strong>Answer</strong></td>
                            <td class="text-right break-word">{{ a.answer }}</td>
                        </tr>
                        <tr>
                            <td><strong>Support</strong></td>
                            <td class="text-right break-word">{{ a.support }}</td>
                        </tr>
                        <tr>
                            <td><strong>Version</strong></td>
                            <td class="text-right break-word">{{ a.version }}</td>
                        </tr>
                        <tr>
                            <td><strong>Status</strong></td>
                            <td class="text-right break-word">
                                {% if consultation.state == 0 and a.foundSupport %}
                                    Found support, waiting for end of voting period
                                {% else %}
                                    {{ a.status|capitalize }}
                                {% endif %}
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            {% endfor %}
        </div>
    </div>
{% endblock %}